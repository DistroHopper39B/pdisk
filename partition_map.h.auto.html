<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>partition_map.h</title>
<style type="text/css">
.enscript-comment { font-style: italic; color: rgb(178,34,34); }
.enscript-function-name { font-weight: bold; color: rgb(0,0,255); }
.enscript-variable-name { font-weight: bold; color: rgb(184,134,11); }
.enscript-keyword { font-weight: bold; color: rgb(160,32,240); }
.enscript-reference { font-weight: bold; color: rgb(95,158,160); }
.enscript-string { font-weight: bold; color: rgb(188,143,143); }
.enscript-builtin { font-weight: bold; color: rgb(218,112,214); }
.enscript-type { font-weight: bold; color: rgb(34,139,34); }
.enscript-highlight { text-decoration: underline; color: 0; }
</style>
</head>
<body id="top">
<h1 style="margin:8px;" id="f1">partition_map.h&nbsp;&nbsp;&nbsp;<span style="font-weight: normal; font-size: 0.5em;">[<a href="partition_map.h">plain text</a>]</span></h1>
<hr/>
<div></div>
<pre>
<span class="enscript-comment">//
</span><span class="enscript-comment">// partition_map.h - partition map routines
</span><span class="enscript-comment">//
</span><span class="enscript-comment">// Written by Eryk Vershen
</span><span class="enscript-comment">//
</span>
<span class="enscript-comment">/*
 * Copyright 1996,1998 by Apple Computer, Inc.
 *              All Rights Reserved 
 *  
 * Permission to use, copy, modify, and distribute this software and 
 * its documentation for any purpose and without fee is hereby granted, 
 * provided that the above copyright notice appears in all copies and 
 * that both the copyright notice and this permission notice appear in 
 * supporting documentation. 
 *  
 * APPLE COMPUTER DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE 
 * INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS 
 * FOR A PARTICULAR PURPOSE. 
 *  
 * IN NO EVENT SHALL APPLE COMPUTER BE LIABLE FOR ANY SPECIAL, INDIRECT, OR 
 * CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM 
 * LOSS OF USE, DATA OR PROFITS, WHETHER IN ACTION OF CONTRACT, 
 * NEGLIGENCE, OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION 
 * WITH THE USE OR PERFORMANCE OF THIS SOFTWARE. 
 */</span>

#<span class="enscript-reference">ifndef</span> <span class="enscript-variable-name">__partition_map__</span>
#<span class="enscript-reference">define</span> <span class="enscript-variable-name">__partition_map__</span>

#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;dpme.h&quot;</span>
#<span class="enscript-reference">include</span> <span class="enscript-string">&quot;media.h&quot;</span>


<span class="enscript-comment">//
</span><span class="enscript-comment">// Defines
</span><span class="enscript-comment">//
</span>#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">PBLOCK_SIZE</span>	512
#<span class="enscript-reference">define</span>	<span class="enscript-variable-name">MAX_LINUX_MAP</span>	15


<span class="enscript-comment">//
</span><span class="enscript-comment">// Types
</span><span class="enscript-comment">//
</span><span class="enscript-type">struct</span> partition_map_header {
    MEDIA m;
    <span class="enscript-type">char</span> *name;
    <span class="enscript-type">struct</span> partition_map * disk_order;
    <span class="enscript-type">struct</span> partition_map * base_order;
    Block0 *misc;
    <span class="enscript-type">int</span> writable;
    <span class="enscript-type">int</span> changed;
    <span class="enscript-type">int</span> written;
    <span class="enscript-type">int</span> physical_block;		<span class="enscript-comment">// must be == sbBlockSize
</span>    <span class="enscript-type">int</span> logical_block;		<span class="enscript-comment">// must be &lt;= physical_block
</span>    <span class="enscript-type">int</span> blocks_in_map;
    <span class="enscript-type">int</span> maximum_in_map;
    <span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> media_size;	<span class="enscript-comment">// in logical_blocks
</span>};
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> partition_map_header partition_map_header;

<span class="enscript-type">struct</span> partition_map {
    <span class="enscript-type">struct</span> partition_map * next_on_disk;
    <span class="enscript-type">struct</span> partition_map * prev_on_disk;
    <span class="enscript-type">struct</span> partition_map * next_by_base;
    <span class="enscript-type">struct</span> partition_map * prev_by_base;
    <span class="enscript-type">long</span> disk_address;
    <span class="enscript-type">struct</span> partition_map_header * the_map;
    <span class="enscript-type">int</span> contains_driver;
    DPME *data;
    <span class="enscript-type">int</span> HFS_kind;
    <span class="enscript-type">char</span> *HFS_name;
};
<span class="enscript-type">typedef</span> <span class="enscript-type">struct</span> partition_map partition_map;

<span class="enscript-comment">/* Identifies the HFS kind. */</span>
<span class="enscript-type">enum</span> {
    kHFS_not       =   0,	<span class="enscript-comment">// ' '
</span>    kHFS_std       =   1,	<span class="enscript-comment">// 'h'
</span>    kHFS_embed     =   2,	<span class="enscript-comment">// 'e'
</span>    kHFS_plus      =   3	<span class="enscript-comment">// '+'
</span>};


<span class="enscript-comment">//
</span><span class="enscript-comment">// Global Constants
</span><span class="enscript-comment">//
</span><span class="enscript-type">extern</span> <span class="enscript-type">const</span> <span class="enscript-type">char</span> * kFreeType;
<span class="enscript-type">extern</span> <span class="enscript-type">const</span> <span class="enscript-type">char</span> * kMapType;
<span class="enscript-type">extern</span> <span class="enscript-type">const</span> <span class="enscript-type">char</span> * kUnixType;
<span class="enscript-type">extern</span> <span class="enscript-type">const</span> <span class="enscript-type">char</span> * kHFSType;
<span class="enscript-type">extern</span> <span class="enscript-type">const</span> <span class="enscript-type">char</span> * kFreeName;
<span class="enscript-type">extern</span> <span class="enscript-type">const</span> <span class="enscript-type">char</span> * kPatchType;


<span class="enscript-comment">//
</span><span class="enscript-comment">// Global Variables
</span><span class="enscript-comment">//
</span><span class="enscript-type">extern</span> <span class="enscript-type">int</span> rflag;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> interactive;
<span class="enscript-type">extern</span> <span class="enscript-type">int</span> dflag;


<span class="enscript-comment">//
</span><span class="enscript-comment">// Forward declarations
</span><span class="enscript-comment">//
</span><span class="enscript-type">int</span> <span class="enscript-function-name">add_partition_to_map</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *name, <span class="enscript-type">const</span> <span class="enscript-type">char</span> *dptype, u32 base, u32 length, partition_map_header *map);
<span class="enscript-type">void</span> <span class="enscript-function-name">close_partition_map</span>(partition_map_header *map);
partition_map_header* <span class="enscript-function-name">create_partition_map</span>(<span class="enscript-type">char</span> *name, partition_map_header *oldmap, <span class="enscript-type">int</span> oflag);
<span class="enscript-type">void</span> <span class="enscript-function-name">delete_partition_from_map</span>(partition_map *entry);
partition_map* <span class="enscript-function-name">find_entry_by_disk_address</span>(<span class="enscript-type">long</span>, partition_map_header *);
partition_map* <span class="enscript-function-name">find_entry_by_type</span>(<span class="enscript-type">const</span> <span class="enscript-type">char</span> *type_name, partition_map_header *map);
partition_map* <span class="enscript-function-name">find_entry_by_base</span>(u32 base, partition_map_header *map);
partition_map_header* <span class="enscript-function-name">init_partition_map</span>(<span class="enscript-type">char</span> *name, partition_map_header* oldmap, <span class="enscript-type">int</span> oflag);
<span class="enscript-type">void</span> <span class="enscript-function-name">move_entry_in_map</span>(<span class="enscript-type">long</span>, <span class="enscript-type">long</span>, partition_map_header *);
partition_map_header* <span class="enscript-function-name">open_partition_map</span>(<span class="enscript-type">char</span> *name, <span class="enscript-type">int</span> *valid_file, <span class="enscript-type">int</span> ask_logical_size, <span class="enscript-type">int</span> oflag);
<span class="enscript-type">void</span> <span class="enscript-function-name">resize_map</span>(<span class="enscript-type">unsigned</span> <span class="enscript-type">long</span> new_size, partition_map_header *map);
<span class="enscript-type">void</span> <span class="enscript-function-name">write_partition_map</span>(partition_map_header *map);
<span class="enscript-type">void</span> <span class="enscript-function-name">bzb_init_slice</span>(BZB *bp, <span class="enscript-type">int</span> slice);
<span class="enscript-type">void</span> <span class="enscript-function-name">dpme_init_flags</span>(DPME *data);

#<span class="enscript-reference">endif</span> <span class="enscript-comment">/* __partition_map__ */</span>
</pre>
<hr />
</body></html>